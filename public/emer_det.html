<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trust Circles | Police Control</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <style>
    body {
      background-color: #020617;
      display: block;
    }

    .contact-card {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--glass-border);
      border-radius: 1.5rem;
      padding: 1.5rem;
      transition: var(--transition);
    }

    .contact-card:hover {
      border-color: var(--primary);
    }

    .circle-stat {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .phone-badge {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(99, 102, 241, 0.1);
      color: var(--primary);
      padding: 0.5rem 1rem;
      border-radius: 0.75rem;
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
    }
  </style>
</head>

<body>

  <div class="nav-container">
    <div style="display: flex; align-items: center; gap: 1rem;">
      <i class="ph ph-shield-plus" style="font-size: 2rem; color: var(--primary);"></i>
      <a href="police_dash.html" class="nav-brand">Trust Circle Index</a>
    </div>
    <a href="police_dash.html" class="btn btn-secondary">
      <i class="ph ph-arrow-left"></i> Hub
    </a>
  </div>

  <div class="container" style="max-width: 1200px; margin: 2rem auto; padding: 0 2rem;">
    <header style="margin-bottom: 3rem; text-align: center;">
      <h1 style="color: white; -webkit-text-fill-color: white;">Emergency Contact Registry</h1>
      <p style="color: var(--text-muted);">Manage emergency rescue contacts for registered travelers.</p>
    </header>

    <div id="contact-list" class="grid grid-cols-2">
      <div style="grid-column: 1/-1; text-align: center; padding: 4rem;">
        <i class="ph ph-circle-notch animate-spin" style="font-size: 2rem; color: var(--primary);"></i>
        <p style="margin-top: 1rem;">Syncing safety circles...</p>
      </div>
    </div>
  </div>

  <script>
    fetch('/emergency_data', { method: 'POST' })
      .then(r => r.json())
      .then(data => {
        const container = document.getElementById('contact-list');
        if (data.length === 0) {
          container.innerHTML = '<p style="grid-column: 1/-1; text-align: center;">No emergency circles found.</p>';
          return;
        }

        let html = '';
        data.forEach(user => {
          html += `
                        <div class="contact-card animate-fade-in">
                            <div class="circle-stat">
                                <div style="width: 48px; height: 48px; background: rgba(99, 102, 241, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--primary); font-size: 1.5rem;">
                                    <i class="ph ph-user-circle"></i>
                                </div>
                                <div>
                                    <h3 style="margin: 0; background: none; -webkit-text-fill-color: initial; color: white;">${user.UserName}</h3>
                                    <p style="margin: 0; font-size: 0.75rem; color: var(--text-muted);">${user.Email}</p>
                                </div>
                            </div>
                            
                            <div style="margin-top: 1rem;">
                                <div style="font-size: 0.75rem; font-weight: 600; color: var(--text-muted); margin-bottom: 0.5rem; text-transform: uppercase;">Linked Emergency Numbers</div>
                                <div class="phone-badge"><i class="ph ph-number-one"></i> Primary: ${user.FirstNumber}</div>
                                <div class="phone-badge"><i class="ph ph-number-two"></i> Secondary: ${user.SecondNumber}</div>
                                <div class="phone-badge"><i class="ph ph-number-three"></i> Tertiary: ${user.ThirdNumber}</div>
                            </div>
                            
                            <div style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--glass-border); display: flex; justify-content: space-between; align-items: center;">
                                <span style="font-size: 0.75rem; color: var(--text-muted);">Traveler ID: ${user._id.slice(-6)}</span>
                                <button class="btn btn-primary" style="padding: 0.5rem 1rem; font-size: 0.75rem;" onclick="window.location.href='tel:${user.FirstNumber}'">
                                    <i class="ph ph-phone-call"></i> Call Rescue
                                </button>
                            </div>
                        </div>
                    `;
        });
        container.innerHTML = html;
      })
      .catch(err => {
        document.getElementById('contact-list').innerHTML = `<p style="grid-column: 1/-1; text-align: center;">Error: ${err.message}</p>`;
      });
  </script>
</body>

</html>