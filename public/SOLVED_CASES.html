<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solved Archive | Police Command</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        :root {
            --primary: #00ff9d;
            --secondary: #00f2ff;
            --bg-dark: #05070a;
            --card-bg: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.08);
            --text-dim: #94a3b8;
        }

        body {
            background-color: var(--bg-dark);
            color: #fff;
            font-family: 'Inter', sans-serif;
            margin: 0;
            display: block;
        }

        .nav-container {
            padding: 1rem 2rem;
            background: rgba(10, 12, 18, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .container {
            max-width: 1200px;
            margin: 3rem auto;
            padding: 0 2rem;
        }

        .archive-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 1.5rem;
            padding: 2rem;
            backdrop-filter: blur(20px);
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 0.5rem;
        }

        th {
            text-align: left;
            padding: 1rem;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--primary);
            font-weight: 800;
        }

        td {
            padding: 1.5rem 1rem;
            background: rgba(255, 255, 255, 0.02);
            border-top: 1px solid var(--border);
            border-bottom: 1px solid var(--border);
        }

        td:first-child {
            border-left: 1px solid var(--border);
            border-radius: 1rem 0 0 1rem;
        }

        td:last-child {
            border-right: 1px solid var(--border);
            border-radius: 0 1rem 1rem 0;
        }

        .mission-id {
            font-family: monospace;
            font-weight: 900;
            color: var(--primary);
            background: rgba(0, 255, 157, 0.1);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <div class="nav-container">
        <div style="display: flex; align-items: center; gap: 1rem;" onclick="location.href='police_dash.html'"
            style="cursor:pointer;">
            <img src="travel_logo.png" style="width: 32px;">
            <div style="font-weight: 900; letter-spacing: 1px;">METRO_FORCE / ARCHIVE</div>
        </div>
        <button class="btn btn-secondary" onclick="location.href='police_dash.html'"><i class="ph ph-house"></i>
            HUB</button>
    </div>

    <div class="container">
        <header style="margin-bottom: 4rem;">
            <h1 style="font-weight: 900; font-size: 2.5rem; margin-bottom: 0.5rem;">MISSION_ARCHIVE</h1>
            <p style="color: var(--text-dim); font-family: monospace;">[HISTORICAL_RECORD_INTEGRITY: 100%]</p>
        </header>

        <div class="archive-card">
            <table>
                <thead>
                    <tr>
                        <th>MISSION_ID</th>
                        <th>CITIZEN_TARGET</th>
                        <th>LOCATION_DECODER</th>
                        <th>RESOLVED_BY</th>
                        <th>TIMESTAMP</th>
                    </tr>
                </thead>
                <tbody id="solvedFeed">
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 5rem;">
                            <i class="ph ph-circle-notch animate-spin"
                                style="font-size: 2rem; color: var(--primary);"></i>
                            <p style="margin-top: 1rem; color: var(--text-dim);">FETCHING_ENCRYPTED_LOGS...</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        async function loadSolved() {
            try {
                const res = await fetch('/api/police/solved');
                const data = await res.json();
                const feed = document.getElementById('solvedFeed');

                if (!data.solved || data.solved.length === 0) {
                    feed.innerHTML = '<tr><td colspan="5" style="text-align:center; padding:5rem; color:var(--text-dim);">NO_HISTORICAL_MATCHES_IN_DATABASE</td></tr>';
                    return;
                }

                feed.innerHTML = data.solved.map(c => `
                    <tr>
                        <td><span class="mission-id">#${c._id.slice(-6).toUpperCase()}</span></td>
                        <td>
                            <div style="font-weight: 800; color: #fff;">${c.name}</div>
                            <div style="font-size: 0.65rem; color: var(--text-dim);">${c.email}</div>
                        </td>
                        <td>
                            <div style="font-size: 0.8rem;">${c.place}</div>
                        </td>
                        <td>
                            <div style="font-weight: 800; color: var(--secondary);">${c.officerName || 'SYSTEM_AUTO'}</div>
                            <div style="font-size: 0.65rem; color: var(--text-dim);">BADGE: ${c.resolvedBy || 'AUTO'}</div>
                        </td>
                        <td>
                            <div style="font-size: 0.7rem; color: var(--text-dim);">${new Date(c.resolvedAt).toLocaleString()}</div>
                        </td>
                    </tr>
                `).join('');
            } catch (e) {
                console.error(e);
                document.getElementById('solvedFeed').innerHTML = '<tr><td colspan="5" style="text-align:center; padding:5rem; color:var(--danger);">ARCHIVE_ACCESS_DENIED</td></tr>';
            }
        }
        loadSolved();
    </script>
</body>

</html>