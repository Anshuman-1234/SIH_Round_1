<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Citizen Registry | Police Control</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <style>
    body {
      background-color: #020617;
      display: block;
    }

    .user-card {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--glass-border);
      border-radius: 1rem;
      padding: 1.5rem;
      display: flex;
      align-items: center;
      gap: 1.5rem;
      transition: var(--transition);
    }

    .user-card:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: var(--primary);
    }

    .avatar {
      width: 60px;
      height: 60px;
      background: var(--primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: 700;
      color: white;
    }
  </style>
</head>

<body>

  <div class="nav-container">
    <div style="display: flex; align-items: center; gap: 1rem;">
      <i class="ph ph-users-four" style="font-size: 2rem; color: var(--primary);"></i>
      <a href="police_dash.html" class="nav-brand">Citizen Registry</a>
    </div>
    <a href="police_dash.html" class="btn btn-secondary">
      <i class="ph ph-arrow-left"></i> Hub
    </a>
  </div>

  <div class="container" style="max-width: 1200px; margin: 2rem auto; padding: 0 2rem;">
    <header style="margin-bottom: 3rem; text-align: center;">
      <h1>Registered Travelers</h1>
      <p style="color: var(--text-muted);">Secure access to citizen identity records and credentials.</p>

      <div class="search-box-container"
        style="max-width: 500px; margin: 2rem auto 0; background: rgba(255, 255, 255, 0.05);">
        <i class="ph ph-magnifying-glass" style="margin-left: 1rem; color: var(--text-muted);"></i>
        <input type="text" id="search" placeholder="Search by name, email, or Aadhaar..." style="padding: 1rem;">
      </div>
    </header>

    <div id="user-list" class="grid grid-cols-2">
      <!-- Data will be injected here -->
      <div style="grid-column: 1/-1; text-align: center; padding: 4rem;">
        <i class="ph ph-circle-notch animate-spin" style="font-size: 2rem; color: var(--primary);"></i>
        <p style="margin-top: 1rem;">Decrypted records loading...</p>
      </div>
    </div>
  </div>

  <script>
    let users = [];

    fetch('/login_data', { method: 'POST' })
      .then(r => r.json())
      .then(data => {
        users = data;
        render(users);
      })
      .catch(err => {
        document.getElementById('user-list').innerHTML = `<p style="grid-column: 1/-1; text-align: center; color: var(--danger);">Failed to load records: ${err.message}</p>`;
      });

    function render(data) {
      const q = document.getElementById('search').value.toLowerCase();
      const filtered = data.filter(u =>
        (u.name && u.name.toLowerCase().includes(q)) ||
        (u.email && u.email.toLowerCase().includes(q)) ||
        (u.card && u.card.includes(q))
      );

      let html = '';
      filtered.forEach(u => {
        const initial = u.name ? u.name.charAt(0).toUpperCase() : '?';
        html += `
                    <div class="user-card animate-fade-in">
                        <div class="avatar">${initial}</div>
                        <div style="flex: 1;">
                            <h3 style="margin: 0; background: none; -webkit-text-fill-color: initial; color: white;">${u.name || 'Anonymous'}</h3>
                            <div style="font-size: 0.875rem; color: var(--text-muted);">${u.email}</div>
                            <div style="margin-top: 0.5rem; display: flex; gap: 1rem;">
                                <span style="font-size: 0.75rem;"><i class="ph ph-phone"></i> ${u.phone || 'N/A'}</span>
                                <span style="font-size: 0.75rem;"><i class="ph ph-identification-badge"></i> ${u.card || 'N/A'}</span>
                            </div>
                        </div>
                        <button class="btn btn-secondary" style="padding: 0.5rem;" onclick="alert('Viewing full profile for ${u.name}')">
                            <i class="ph ph-eye"></i>
                        </button>
                    </div>
                `;
      });

      document.getElementById('user-list').innerHTML = html || '<p style="grid-column: 1/-1; text-align: center;">No matching citizens found.</p>';
    }

    document.getElementById('search').oninput = () => render(users);
  </script>
</body>

</html>