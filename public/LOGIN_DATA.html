<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Citizen Registry | Police Command</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    :root {
      --primary: #00ff9d;
      --accent: #00f2ff;
      --bg-dark: #05070a;
      --card-bg: rgba(255, 255, 255, 0.03);
      --border: rgba(255, 255, 255, 0.08);
      --text-dim: #94a3b8;
    }

    body {
      background-color: var(--bg-dark);
      color: #fff;
      font-family: 'Inter', sans-serif;
      margin: 0;
      display: block;
    }

    .nav-container {
      padding: 1rem 2rem;
      background: rgba(10, 12, 18, 0.9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .container {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 2rem;
    }

    .registry-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 1.5rem;
      margin-top: 3rem;
    }

    .user-card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 1.25rem;
      padding: 1.5rem;
      display: flex;
      align-items: center;
      gap: 1.5rem;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .user-card:hover {
      transform: translateY(-5px);
      border-color: var(--primary);
      background: rgba(255, 255, 255, 0.05);
    }

    .user-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: var(--primary);
      opacity: 0.3;
    }

    .avatar-box {
      width: 60px;
      height: 60px;
      background: var(--primary);
      color: #000;
      border-radius: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: 900;
      box-shadow: 0 0 20px var(--primary-glow);
    }

    .input-tactical {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border);
      padding: 1rem 1.5rem;
      border-radius: 0.75rem;
      color: #fff;
      width: 100%;
      outline: none;
      transition: border-color 0.3s ease;
    }

    .input-tactical:focus {
      border-color: var(--primary);
    }

    .tag {
      font-size: 0.6rem;
      font-weight: 800;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      background: rgba(0, 255, 157, 0.1);
      color: var(--primary);
      text-transform: uppercase;
    }
  </style>
</head>

<body>
  <div class="nav-container">
    <div style="display: flex; align-items: center; gap: 1rem;" onclick="location.href='police_dash.html'"
      style="cursor:pointer;">
      <img src="travel_logo.png" style="width: 32px;">
      <div style="font-weight: 900; letter-spacing: 1px;">METRO_FORCE / REGISTRY</div>
    </div>
    <div style="display: flex; gap: 1rem;">
      <button class="btn btn-secondary" onclick="exportRegistry()"><i class="ph ph-file-xls"></i> EXPORT_ALL</button>
      <button class="btn btn-primary" onclick="location.href='police_dash.html'"><i class="ph ph-house"></i>
        HUB</button>
    </div>
  </div>

  <div class="container">
    <header style="margin-bottom: 4rem; text-align: center;">
      <h1 style="font-weight: 900; font-size: 2.5rem; margin-bottom: 0.5rem;">CITIZEN_RECORDS</h1>
      <p style="color: var(--text-dim);">SECURE IDENTITY DATABASE & TRAVELER VERIFICATION</p>

      <div style="max-width: 600px; margin: 3rem auto 0; position: relative;">
        <i class="ph ph-magnifying-glass"
          style="position: absolute; left: 1.25rem; top: 50%; transform: translateY(-50%); color: var(--text-dim);"></i>
        <input type="text" id="search" class="input-tactical" placeholder="SEARCH_BY_NAME_EMAIL_OR_UUID"
          style="padding-left: 3.5rem;">
      </div>
    </header>

    <div id="user-list" class="registry-grid">
      <!-- Data injected here -->
      <div style="grid-column: 1/-1; text-align: center; padding: 5rem;">
        <i class="ph ph-circle-notch animate-spin" style="font-size: 2.5rem; color: var(--primary);"></i>
        <p style="margin-top: 1rem; color: var(--text-dim); letter-spacing: 2px;">DECRYPTING_DATABASE...</p>
      </div>
    </div>
  </div>

  <script>
    let users = [];

    async function fetchUsers() {
      try {
        const res = await fetch('/login_data', { method: 'POST' });
        users = await res.json();
        render();
      } catch (err) {
        document.getElementById('user-list').innerHTML = `<p style="grid-column: 1/-1; text-align: center; color: var(--danger);">DATABASE_ACCESS_ERROR: ${err.message}</p>`;
      }
    }

    function render() {
      const q = document.getElementById('search').value.toLowerCase();
      const filtered = users.filter(u =>
        (u.name && u.name.toLowerCase().includes(q)) ||
        (u.email && u.email.toLowerCase().includes(q)) ||
        (u.card && u.card.includes(q))
      );

      document.getElementById('user-list').innerHTML = filtered.map(u => {
        const initial = u.name ? u.name.charAt(0).toUpperCase() : '?';
        return `
                    <div class="user-card">
                        <div class="avatar-box">${initial}</div>
                        <div style="flex: 1;">
                            <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                                <h3 style="margin: 0; font-weight: 800; font-size: 1.1rem;">${u.name || 'ANONYMOUS_USER'}</h3>
                                <span class="tag">VERIFIED</span>
                            </div>
                            <div style="font-size: 0.8rem; color: var(--text-dim); margin-top: 0.25rem;">${u.email}</div>
                            <div style="margin-top: 1rem; display: flex; flex-direction: column; gap: 0.4rem;">
                                <div style="font-size: 0.7rem; color: var(--primary);"><i class="ph ph-phone"></i> ${u.phone || 'NO_PHONE_RECORDED'}</div>
                                <div style="font-size: 0.7rem; color: var(--accent); font-family:monospace;"><i class="ph ph-fingerprint"></i> UUID: ${u.card || 'PENDING_AUTH'}</div>
                            </div>
                        </div>
                        <button class="btn btn-secondary" style="padding: 0.5rem; border-radius: 0.5rem;" onclick="alert('ACCESSING_PARTIAL_ENCRYPTED_DATA: ${u.name}')">
                            <i class="ph ph-shield-search"></i>
                        </button>
                    </div>
                `;
      }).join('') || '<div style="grid-column: 1/-1; text-align: center; padding: 5rem; color: var(--text-dim);">NO_RECORDS_MATCH_SEARCH_QUERY</div>';
    }

    document.getElementById('search').oninput = render;

    function exportRegistry() {
      const worksheet = XLSX.utils.json_to_sheet(users);
      const workbook = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(workbook, worksheet, "Citizens");
      XLSX.writeFile(workbook, "METRO_FORCE_CITIZEN_REGISTRY.xlsx");
    }

    fetchUsers();
  </script>
</body>

</html>